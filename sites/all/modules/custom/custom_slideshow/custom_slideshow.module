<?php

/**
 * @file
 * A custom client-side slideshow built for developers.
 */

/**
 * Implements hook_init().
 */
function custom_slideshow_init() {
  // Make the the theme call dynamic.
  $default_theme = variable_get('theme_default', 'simplecorp');
  
  /**
   * Add javascript files for the flexislider.
   */
  if (theme_get_setting('slideshow_js',$default_theme)):
  
    drupal_add_js(drupal_get_path('theme', $default_theme) . '/js/plugins/jquery.flexslider-min.js');
  
    //Initialize slideshow using theme settings
    
    $effect=theme_get_setting('slideshow_effect',$default_theme);
    $effect_time=theme_get_setting('slideshow_effect_time',$default_theme)*1000;
    $slideshow_controls=theme_get_setting('slideshow_controls',$default_theme);
    $slideshow_random=theme_get_setting('slideshow_random',$default_theme);
    $slideshow_pause=theme_get_setting('slideshow_pause',$default_theme);
    $slideshow_touch=theme_get_setting('slideshow_touch',$default_theme);
  
    drupal_add_js('
      jQuery(document).ready(function($) {
  
          $(window).load(function() {
  
              $(".flexslider").fadeIn("slow");
  
              $(".flexslider").flexslider({
                  useCSS: false,
                  animation: "'.$effect.'",
                  controlNav: '.$slideshow_controls.',
                  directionNav: '.$slideshow_controls.',
                  animationLoop: true,
                  touch: '.$slideshow_touch.',
                  pauseOnHover: '.$slideshow_pause.',
                  nextText: "&rsaquo;",
                  prevText: "&lsaquo;",
                  keyboard: true,
                  slideshowSpeed: '.$effect_time.',
                  randomize: '.$slideshow_random.',
                  start: function(slider) {
                      slider.removeClass("loading");
                  }
              });
          });
      });',array('type' => 'inline', 'scope' => 'footer', 'weight' => 5)
    );
  
  endif;
  
  ///**
  // * Add javascript files for jquery carousel.
  // */
  //if (theme_get_setting('carousel_js', $default_theme)):
  //
  //  drupal_add_js(drupal_get_path('theme', $default_theme) . '/js/plugins/jquery.jcarousel.min.js');
  //  drupal_add_js(drupal_get_path('theme', $default_theme) . '/js/jquery.easing-1.3.min.js');
  //
  //  //Initialize slideshow using theme settings
  //  $carousel_effect_time=theme_get_setting('carousel_effect_time', $default_theme)*1000;
  //  $carousel_effect=theme_get_setting('carousel_effect', $default_theme);
  //
  //  drupal_add_js('
  //    jQuery(document).ready(function($) {
  //
  //        var currentWindowWidth = jQuery(window).width();
  //        jQuery(window).resize(function() {
  //            currentWindowWidth = jQuery(window).width();
  //        });
  //
  //        $(window).load(function() {
  //
  //            $("ul#projects-carousel").fadeIn("fast");
  //
  //            if (jQuery(".portfolio-item-hover-content").length && jQuery()) {
  //                function hover_effect() {
  //                    jQuery(".portfolio-item-hover-content").hover(function() {
  //                        jQuery(this).find("div,a").stop(0, 0).removeAttr("style");
  //                        jQuery(this).find(".hover-options").animate({
  //                            opacity: 0.9
  //                        }, "fast");
  //                        jQuery(this).find("a").animate({
  //                            "top": "60%"
  //                        });
  //                    }, function() {
  //                        jQuery(this).find(".hover-options").stop(0, 0).animate({
  //                            opacity: 0
  //                        }, "fast");
  //                        jQuery(this).find("a").stop(0, 0).animate({
  //                            "top": "150%"
  //                        }, "slow");
  //                        jQuery(this).find("a.zoom").stop(0, 0).animate({
  //                            "top": "150%"
  //                        }, "slow");
  //                    });
  //                }
  //                hover_effect();
  //            }
  //        
  //            (function() {
  //                var jQuerycarousel = jQuery("#projects-carousel");
  //                if (jQuerycarousel.length) {
  //                    var scrollCount;
  //                    if (jQuery(window).width() < 480) {
  //                        scrollCount = 1;
  //                    } else if (jQuery(window).width() < 768) {
  //                        scrollCount = 1;
  //                    } else if (jQuery(window).width() < 960) {
  //                        scrollCount = 3;
  //                    } else {
  //                        scrollCount = 4;
  //                    }
  //                    jQuerycarousel.jcarousel({
  //                        animation: '.$carousel_effect_time.',
  //                        easing: "'.$carousel_effect.'",
  //                        scroll: scrollCount,
  //                        initCallback: function() {
  //                            jQuerycarousel.removeClass("loading")
  //                        },
  //                    });
  //                }
  //            })();
  //        });
  //    });',	array('type' => 'inline', 'scope' => 'footer', 'weight' => 7)
  //  );	
  //
  //endif;
}

/**
 * Implements hook_block_info().
 */
function custom_slideshow_block_info() {
  $blocks = array();
  
  $blocks['custom_slideshow'] = array(
    'info' => t('Custom Modules / Custom Slideshow'),
  );
  
  return $blocks;
}

/**
 * Implementation of hook_block_view().
 */
function custom_slideshow_block_view($delta = '') {
  // Create an empty block.
  $block = array(
    'subject' => '',
    'content' => '',
  );

  switch ($delta) {
    
    case 'custom_slideshow':
      $block['subject'] = t('');
      $block['content'] = custom_slideshow();
      break;
    }
  
  return $block;
}

/**
 * custom html block
 * @return string
 */
function custom_slideshow() {

  // Send custom_slideshow data objects to custom-slideshow-block.tpl.php which is registered below
  return theme('custom_slideshow', array(
    'keys' => array('u1','u2','u3'),
    // The original slideshow_images are 940 x 350 px
    'slideshow_image' => array('portfolio-pronq.jpg','portfolio-candd-msp.jpg', 'portfolio-candd-contenthub.jpg'),
    'alt_title' => array('img1','img2', 'img3'),
    'which_node' => array('node/7','node/6', 'node/5'),
    //'which_node' => array('pronq-hp','car-and-driver-model-super-page', 'car-and-driver-content-hub', 'car-and-drivers-menu-navigation', 'wealth-management-resource-network', 'industry-week-100-500-and-50-rankings', 'galavante-group', 'yoga-practice-manual'),
    'caption' => array('foo', 'bar', 'baz'),

  )); 
}
/**
 * Implements hook_theme().
 */
function custom_slideshow_theme() {
  $module_path = drupal_get_path('module', 'custom_slideshow');
  $base = array(
    'path' => "$module_path/theme",
  );
  return array(
    'custom_slideshow' => $base + array(
      'template' => 'custom-slideshow-block',
      'variables' => array(
        'keys' => NULL,
        'slideshow_image' => NULL,
        'alt_title' => NULL,
        'which_node' => NULL,
        'caption' => NULL,
      ),
    ),
  );
}
